<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>销售出库单</title>
	<link rel="stylesheet" href="../../css/xiaoshou/xs_chuku.css">
	<link rel="stylesheet" href="../../layui/css/layui.css">
	<link rel="stylesheet" href="../../css/common.css">
	<style>
		[readonly] {
			cursor: default;
		}
	</style>
</head>
<body style="width: 100%;padding: 10px 20px;box-sizing: border-box;min-width: 900px;">
<form class="layui-form pic-ok">
	<div class="layui-form-item">
		<div class="layui-input-block" style="margin-left: 0">
			<ul class="layui-nav" style="background-color: transparent;">
				<li class="layui-nav-item">
					<a href="javascript:;" class="iconfont menu-list" title="上一条" id="menu-prev">
						<i class="layui-icon">&#xe603;</i>
					</a>
				</li>
				<li class="layui-nav-item">
					<a href="javascript:;" class="iconfont menu-list" title="下一条" id="menu-next">
						<i class="layui-icon">&#xe602;</i>
					</a>
				</li>
				<li class="layui-nav-item">
					<a href="javascript:;" class="iconfont menu-list" title="新增" id="menu-add">
						<i class="layui-icon">&#xe654;</i>
					</a>
				</li>
				<li class="layui-nav-item">
					<a href="javascript:;" class="iconfont menu-list" title="修改" id="menu-update"
					   disabled>
						<i class="layui-icon">&#xe642;</i>
					</a>
				</li>
				<li class="layui-nav-item">
					<a href="javascript:;" class="iconfont menu-list" title="删除" id="menu-delete">
						<i class="layui-icon">&#xe640;</i>
					</a>
				</li>
				<li class="layui-nav-item">
					<a href="javascript:;" class="iconfont menu-list" title="审核" id="menu-adopt"
					   disabled="">
						<i class="layui-icon">&#xe605;</i>
					</a>
				</li>
				<li class="layui-nav-item">
					<a href="javascript:;" class="iconfont menu-list" title="反审核" id="menu-refuse">
						<i class="layui-icon">&#x1006;</i>
					</a>
				</li>
				<li class="layui-nav-item">
					<a href="javascript:;" class="iconfont menu-list" title="刷新" id="menu-refresh">
						<i class="layui-icon">&#x1002;</i>
					</a>
				</li>
				<li class="layui-nav-item" style="margin-left: 20px;">
					<a href="javascript:;">查询</a>
					<dl class="layui-nav-child">
						<dd><a href="" disabled="">历史交易查询</a></dd>
						<dd><a href="">单据状况查询</a></dd>
					</dl>
				</li>
				<li class="layui-nav-item">
					<a href="javascript:;">转单</a>
					<dl class="layui-nav-child">
						<dd><a href="">销售报价转入</a></dd>
						<dd><a href="">销售订单转入</a></dd>
					</dl>
				</li>
			</ul>
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">客户</label>
		<div class="layui-input-inline">
			<input type="text" class="layui-input" id="custid" readonly>
		</div>
		<label class="layui-form-label">单据日期</label>
		<div class="layui-input-inline">
			<input id="date" type="text" class="layui-input" id="billdate"
				   onclick="layui.laydate({elem: this, choose: queryId})" readonly>
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">送货地址</label>
		<div class="layui-input-inline">
			<input type="text" class="layui-input">
		</div>
		<label class="layui-form-label">单据号码</label>
		<div class="layui-input-inline">
			<input type="text" class="layui-input" id="billno" readonly>
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">销售出库类型</label>
		<div class="layui-input-inline">
			<input type="text" class="layui-input" id="saleclassid" readonly>
		</div>
		<label class="layui-form-label">币别</label>
		<div class="layui-input-inline">
			<input type="text" class="layui-input" value="人民币" readonly>
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">单价是否含税</label>
		<div class="layui-input-inline">
			<select id="shui" disabled>
				<option value="0" selected>含税</option>
				<option value="1">未税</option>
			</select>
		</div>
		<label class="layui-form-label">汇率</label>
		<div class="layui-input-inline">
			<input type="text" class="layui-input" value="1.0000" readonly>
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">仓库</label>
		<div class="layui-input-inline">
			<input type="text" class="layui-input" id="wareid" readonly>
		</div>
	</div>
</form>
<div class="layui-tab layui-tab-brief">
	<ul class="layui-tab-title">
		<li class="layui-this" lay-id="1">内容</li>
		<li lay-id="2">备注</li>
	</ul>
	<div class="layui-tab-content" style="height: 300px;overflow: scroll;padding: 0;">
		<div class="layui-tab-item layui-show">
			<table class="layui-table" style="margin: 0;width: 4000px;">
				<thead>
				<tr>
					<th>栏号</th>
					<th>物料编号</th>
					<th>物料名称</th>
					<th>规格型号</th>
					<th>单位名称</th>
					<th>数量</th>
					<th>折扣前单价</th>
					<th>折数</th>
					<th>单价</th>
					<th>金额</th>
					<th>税率</th>
					<th>税额</th>
					<th>含税金额</th>
					<th>批号</th>
					<th>物料组合</th>
					<th>赠品</th>
					<th>分录备注</th>
					<th>来源单别</th>
					<th>来源单号</th>
					<th>客户订单</th>
				</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
		<div class="layui-tab-item" style="padding-top: 10px;padding-right: 10px;">
			<form class="layui-form">
				<div class="layui-form-item">
					<label class="layui-form-label">自定栏1</label>
					<div class="layui-input-inline">
						<input type="text" class="layui-input">
					</div>
					<label class="layui-form-label">自定栏2</label>
					<div class="layui-input-inline">
						<input type="text" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">收款条件</label>
					<div class="layui-input-block">
						<textarea name="desc" placeholder="请输入内容"
								  class="layui-textarea"></textarea>
					</div>
				</div>
			</form>
		</div>
	</div>
</div>
<form class="layui-form">
	<div class="layui-form-item">
		<label class="layui-form-label">业务人员</label>
		<div class="layui-input-inline">
			<input type="text" class="layui-input" id="salesid" readonly>
		</div>
		<label class="layui-form-label">制单人员</label>
		<div class="layui-input-inline">
			<input type="text" class="layui-input">
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">所属部门</label>
		<div class="layui-input-inline">
			<input type="text" class="layui-input" id="departid" readonly>
		</div>
		<label class="layui-form-label">复核人员</label>
		<div class="layui-input-inline">
			<input type="text" class="layui-input">
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">所属项目</label>
		<div class="layui-input-inline">
			<input type="text" class="layui-input">
		</div>
	</div>
</form>

<script src="../../layui/lay/dest/layui.all.js"></script>
<script src="../../js/jquery-1.12.4.js"></script>
<script src="../../js/xiaoshou/xs_chuku.js"></script>
<script>
    getDate();

    function getDate() {
        var date = new Date();
        var year = date.getFullYear();
        var month = date.getMonth();
        if (month < 10)
            month = "0" + month;
        var day = date.getDate();
        if (day < 10)
            day = "0" + day;
        date = year + "-" + month + "-" + day;
        $("#date").val(date);
        queryId();
    }

    function queryId() {
        $.getJSON("/lhy/query/dsdssalemainId", {date: $("#date").val()}, function (data) {
            $("#billno").val(data);
        })
    }

    var windowCustid, windowWareid, windowSalesid, windowSaleclassid;
    $("#custid").dblclick(function () {
        checkCustid();
    })
    $("#wareid").dblclick(function () {
        checkWareid();
    })
    $("#salesid").dblclick(function () {
        checkSalesid();
    })
    $("#saleclassid").dblclick(function () {
        checkSaleclassid();
    })

    function checkCustid() {
        $.getJSON('/lhy/query/customer', function (data) {
            var table = $("<table class='layui-table' style='margin: 0;overflow-y: scroll'></table>");
            var thead = $("<thead></thead>");
            var tbody = $("<tbody></tbody>");
            var th1 = $("<th></th>").text("编号");
            var th2 = $("<th></th>").text("名称");
            thead.append(th1, th2);
            $(data).each(function (i, obj) {
                var tr = $("<tr></tr>").attr("ondblclick", "putValue(windowCustid,'#custid','" + obj.customerfllnae + "')");
                var td1 = $("<td></td>").text(obj.customerid);
                var td2 = $("<td></td>").text(obj.customerfllnae);
                tr.append(td1, td2);
                tbody.append(tr);
            })
            table.append(thead, tbody);
            windowCustid = layer.open({
                type: 1,
                area: ["500px", "300px"],
                title: "选择客户",
                content: nodeToString(table[0]),
                btn: ['取消'],
                yes: function (index, layero) {
                    layer.close(windowCustid);
                }
            });
        })
    }

    function checkWareid() {
        $.getJSON('/lhy/query/warehouse', function (data) {
            var table = $("<table class='layui-table' style='margin: 0;overflow-y: scroll'></table>");
            var thead = $("<thead></thead>");
            var tbody = $("<tbody></tbody>");
            var th1 = $("<th></th>").text("编号");
            var th2 = $("<th></th>").text("名称");
            thead.append(th1, th2);
            $(data).each(function (i, obj) {
                var tr = $("<tr></tr>").attr("ondblclick", "putValue(windowWareid,'#wareid','" + obj.warename + "')");
                var td1 = $("<td></td>").text(obj.wareid);
                var td2 = $("<td></td>").text(obj.warename);
                tr.append(td1, td2);
                tbody.append(tr);
            })
            table.append(thead, tbody);
            windowWareid = layer.open({
                type: 1,
                area: ["500px", "300px"],
                title: "选择仓库",
                content: nodeToString(table[0]),
                btn: ['取消'],
                yes: function (index, layero) {
                    layer.close(windowWareid);
                }
            });
        })
    }

    function checkSalesid() {
        $.getJSON('/lhy/query/personnel', function (data) {
            var table = $("<table class='layui-table' style='margin: 0;overflow-y: scroll'></table>");
            var thead = $("<thead></thead>");
            var tbody = $("<tbody></tbody>");
            var th1 = $("<th></th>").text("编号");
            var th2 = $("<th></th>").text("姓名");
            thead.append(th1, th2);
            $(data).each(function (i, obj) {
                console.info(obj)
                var tr = $("<tr></tr>").attr("ondblclick", "putValue(windowSalesid,'#salesid','" + obj.personname + "','#departid','" + obj.department.departname + "')");
                var td1 = $("<td></td>").text(obj.personid);
                var td2 = $("<td></td>").text(obj.personname);
                tr.append(td1, td2);
                tbody.append(tr);
            })
            table.append(thead, tbody);
            windowSalesid = layer.open({
                type: 1,
                area: ["500px", "300px"],
                title: "选择人员",
                content: nodeToString(table[0]),
                btn: ['取消'],
                yes: function (index, layero) {
                    layer.close(windowSalesid);
                }
            });
        })
    }

    function checkSaleclassid() {
        $.getJSON('/lhy/query/billtype', function (data) {
            var table = $("<table class='layui-table' style='margin: 0;overflow-y: scroll'></table>");
            var thead = $("<thead></thead>");
            var tbody = $("<tbody></tbody>");
            var th1 = $("<th></th>").text("编号");
            var th2 = $("<th></th>").text("类型");
            thead.append(th1, th2);
            $(data).each(function (i, obj) {
                console.info(obj)
                var tr = $("<tr></tr>").attr("ondblclick", "putValue(windowSaleclassid,'#saleclassid','" + obj.classname + "')");
                var td1 = $("<td></td>").text(obj.classid);
                var td2 = $("<td></td>").text(obj.classname);
                tr.append(td1, td2);
                tbody.append(tr);
            })
            table.append(thead, tbody);
            windowSaleclassid = layer.open({
                type: 1,
                area: ["500px", "300px"],
                title: "选择单据类型",
                content: nodeToString(table[0]),
                btn: ['取消'],
                yes: function (index, layero) {
                    layer.close(windowSaleclassid);
                }
            });
        })
    }

    function putValue(window, dom, value, dom2, value2) {
        $(dom).val(value);
        $(dom2).val(value2);
        layer.close(window);
    }

    function nodeToString(node) {
        var tmpNode = document.createElement("div");
        tmpNode.appendChild(node.cloneNode(true));
        var str = tmpNode.innerHTML;
        tmpNode = node = null;
        return str;
    }
</script>
</body>
</html>